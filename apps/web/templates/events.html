<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Events - ZETA-SYNC</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{--bg:#0b1220;--card:#0f172a;--border:#1f2937;--text:#e5e7eb;--muted:#94a3b8;
      --red:#ef4444;--amber:#fbbf24;--blue:#60a5fa;--mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;}
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui;background:var(--bg);color:var(--text)}
    header{position:sticky;top:0;background:rgba(15,23,42,.9);backdrop-filter: blur(8px);
      border-bottom:1px solid var(--border); padding:14px 18px; display:flex; align-items:center; gap:14px;}
    nav a{color:var(--muted); text-decoration:none; margin-right:10px; font-size:14px}
    nav a:hover{color:var(--text)}
    .wrap{max-width:1100px;margin:0 auto;padding:18px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px}
    .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .title{font-weight:800}
    button{border:0;border-radius:12px;padding:8px 10px;color:white;cursor:pointer;background:#334155;font-weight:700}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:10px 8px;border-bottom:1px solid var(--border);vertical-align:top}
    th{font-size:12px;color:var(--muted);font-weight:700}
    td{font-size:13px}
    .mono{font-family:var(--mono)}
    .sev{display:inline-flex;align-items:center;padding:3px 8px;border-radius:999px;border:1px solid var(--border);font-size:12px}
    .sev.err{background:rgba(239,68,68,.12);border-color:rgba(239,68,68,.35)}
    .sev.warn{background:rgba(251,191,36,.12);border-color:rgba(251,191,36,.35)}
    .sev.info{background:rgba(96,165,250,.12);border-color:rgba(96,165,250,.35)}
  </style>
</head>
<body>
<header>
  <div style="font-weight:800;">ZETA-SYNC</div>
  <nav>
    <a href="/">Home</a>
    <a href="/nodes">Nodes</a>
    <a href="/events">Events</a>
    <a href="/security">Security</a>
  </nav>
  <div style="margin-left:auto"><button onclick="refreshAll()">Refresh</button></div>
</header>

<div class="wrap">
  <div class="card">
    <div class="row" style="justify-content:space-between;">
      <div>
        <div class="title">Events</div>
        <div style="font-size:12px;color:var(--muted)">Latest 200 (newest first)</div>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th>seq</th>
          <th>node</th>
          <th>type</th>
          <th>severity</th>
          <th>detail</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>

<script>
  const $ = (id) => document.getElementById(id);

  async function apiGet(url){
    const r = await fetch(url,{cache:"no-store"});
    if(!r.ok) throw new Error(url+" -> "+r.status);
    return await r.json();
  }

  function sevPill(s){
    const v = String(s||"INFO").toUpperCase();
    let cls = "sev info";
    if(v==="ERROR") cls="sev err";
    else if(v==="WARNING"||v==="WARN") cls="sev warn";
    return `<span class="${cls}">${v}</span>`;
  }

  async function refreshAll(){
    const tb = $("tbody");
    tb.innerHTML = "";
    const data = await apiGet("/api/v1/cluster/events");
    const events = (data.events || []).slice().reverse();

    for(const ev of events){
      const detail = {...ev};
      delete detail.node_id; delete detail.sequence_id; delete detail.event_type; delete detail.severity;
      tb.insertAdjacentHTML("beforeend", `
        <tr>
          <td class="mono">${ev.sequence_id ?? "-"}</td>
          <td class="mono">${ev.node_id ?? "-"}</td>
          <td class="mono">${ev.event_type ?? "-"}</td>
          <td>${sevPill(ev.severity)}</td>
          <td class="mono">${JSON.stringify(detail)}</td>
        </tr>
      `);
    }
  }

  refreshAll();
  setInterval(refreshAll, 2000);
</script>
</body>
</html>
