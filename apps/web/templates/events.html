<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ZETA-SYNC Events</title>
    <link rel="stylesheet" href="/static/app.css" />
  </head>
  <body>
    <div class="wrap">
      <header class="top">
        <div>
          <div class="brand">ZETA-SYNC</div>
          <div class="sub">Events</div>
        </div>
        <nav class="nav">
          <a href="/">Home</a>
          <a href="/nodes">Nodes</a>
          <a class="active" href="/events">Events</a>
          <a href="/security">Security</a>
        </nav>
      </header>

      <div class="card">
        <div class="row spread">
          <div>
            <h2 style="margin:0">Event stream</h2>
            <div class="muted">Sorted by timestamp. sequence_id is per-node.</div>
          </div>
          <button class="btn" onclick="loadEvents()">Refresh</button>
        </div>

        <div id="events"></div>

        <details class="adv">
          <summary>Advanced / Debug</summary>
          <pre id="rawEvents"></pre>
        </details>
      </div>
    </div>

    <script src="/static/app.js"></script>
    <script>
      function fmtTs(ts){
        if(!ts) return "-";
        const d = new Date(ts*1000);
        return d.toLocaleString();
      }

      function row(e){
        const id = (e.event_id || "").slice(0,10);
        const sev = (e.severity || "INFO").toLowerCase();
        return `
          <div class="event">
            <div class="row spread">
              <div class="mono small">${escapeHtml(fmtTs(e.ts))}</div>
              <div class="pill ${sev}">${escapeHtml(e.severity || "INFO")}</div>
            </div>
            <div class="row spread">
              <div>
                <b>${escapeHtml(e.event_type || "-")}</b>
                <div class="muted small">
                  node: <span class="mono">${escapeHtml(e.node_id || "-")}</span> ·
                  seq: <span class="mono">${escapeHtml(String(e.sequence_id ?? "-"))}</span> ·
                  id: <span class="mono">${escapeHtml(id)}</span>
                </div>
              </div>
            </div>

            <details class="adv">
              <summary>Details</summary>
              <pre>${escapeHtml(JSON.stringify(e, null, 2))}</pre>
            </details>
          </div>
        `;
      }

      async function loadEvents(){
        const res = await fetch("/api/v1/cluster/events?limit=200").then(r=>r.json());
        const events = res.events || [];
        document.getElementById("events").innerHTML = events.map(row).join("") || `<div class="muted">No events.</div>`;
        document.getElementById("rawEvents").textContent = JSON.stringify(res, null, 2);
      }

      loadEvents();
      setInterval(loadEvents, 2500);
    </script>
  </body>
</html>
